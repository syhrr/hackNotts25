<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öîÔ∏è Medieval D&D Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cinzel', 'Georgia', serif;
            background: linear-gradient(135deg, #1a0f0a 0%, #3d2817 100%);
            color: #f4e4c1;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(180deg, #2a1810 0%, #1f1108 100%);
            border: 3px solid #8b6914;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8), inset 0 0 60px rgba(139, 105, 20, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(90deg, #5a3a1a 0%, #8b6914 50%, #5a3a1a 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #d4af37;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            font-size: 2.5em;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            color: #ffd700;
            letter-spacing: 2px;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid #8b6914;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 15px;
            background: rgba(139, 105, 20, 0.2);
            border-radius: 8px;
            border: 1px solid #8b6914;
        }

        .stat-label {
            font-size: 0.8em;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .hp-bar {
            width: 120px;
            height: 10px;
            background: #3d0000;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
            border: 1px solid #8b0000;
        }

        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000 0%, #cc0000 100%);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            background-image: 
                linear-gradient(rgba(139, 105, 20, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 105, 20, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.player {
            text-align: right;
        }

        .message-content {
            display: inline-block;
            padding: 12px 18px;
            border-radius: 10px;
            max-width: 80%;
            line-height: 1.6;
        }

        .message.dm .message-content {
            background: linear-gradient(135deg, #4a2c1a 0%, #3d2414 100%);
            border: 2px solid #8b6914;
            border-left: 4px solid #d4af37;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            text-align: left;
        }

        .message.player .message-content {
            background: linear-gradient(135deg, #1a4a3d 0%, #143d2e 100%);
            border: 2px solid #2d8659;
            border-right: 4px solid #3fa86f;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .message-label {
            font-size: 0.85em;
            opacity: 0.7;
            margin-bottom: 5px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .action-result {
            background: rgba(212, 175, 55, 0.1);
            border-left: 3px solid #d4af37;
            padding: 8px 12px;
            margin-top: 8px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .input-container {
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-top: 2px solid #8b6914;
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            padding: 15px;
            background: rgba(244, 228, 193, 0.1);
            border: 2px solid #8b6914;
            border-radius: 8px;
            color: #f4e4c1;
            font-size: 1em;
            font-family: 'Georgia', serif;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .input-field::placeholder {
            color: rgba(244, 228, 193, 0.5);
        }

        .send-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #8b6914 0%, #d4af37 100%);
            border: none;
            border-radius: 8px;
            color: #1a0f0a;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(212, 175, 55, 0.6);
            background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
        }

        .send-btn:active {
            transform: translateY(0);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #d4af37;
            font-style: italic;
        }

        .loading::after {
            content: '...';
            animation: ellipsis 1.5s infinite;
        }

        @keyframes ellipsis {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .chat-container::-webkit-scrollbar {
            width: 10px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #8b6914;
            border-radius: 5px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #d4af37;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .stats-bar {
                font-size: 0.9em;
            }
            
            .chat-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öîÔ∏è Medieval D&D Quest ‚öîÔ∏è</h1>
        </div>

        <div class="stats-bar">
            <div class="stat">
                <span class="stat-label">üßô Hero</span>
                <span class="stat-value" id="player-name">Hero</span>
            </div>
            <div class="stat">
                <span class="stat-label">‚öîÔ∏è Class</span>
                <span class="stat-value" id="player-class">Fighter</span>
            </div>
            <div class="stat">
                <span class="stat-label">‚ù§Ô∏è HP</span>
                <span class="stat-value" id="player-hp">20/20</span>
                <div class="hp-bar">
                    <div class="hp-fill" id="hp-fill" style="width: 100%"></div>
                </div>
            </div>
            <div class="stat">
                <span class="stat-label">‚≠ê XP</span>
                <span class="stat-value" id="player-xp">0</span>
            </div>
        </div>

        <div class="chat-container" id="chat-container">
            <div class="message dm">
                <div class="message-label">üé≤ Dungeon Master</div>
                <div class="message-content">
                    Welcome, brave adventurer! You stand at the gates of a medieval village as the sun sets behind ancient mountains. The smell of woodsmoke drifts from chimneys, and you hear the distant clang of a blacksmith's hammer. What do you do?
                </div>
            </div>
        </div>

        <div class="input-container">
            <input 
                type="text" 
                class="input-field" 
                id="input-field" 
                placeholder="Describe your action..."
                autocomplete="off"
            >
            <button class="send-btn" id="send-btn">Send</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        const chatContainer = document.getElementById('chat-container');
        const inputField = document.getElementById('input-field');
        const sendBtn = document.getElementById('send-btn');

        const playerNameEl = document.getElementById('player-name');
        const playerClassEl = document.getElementById('player-class');
        const playerHpEl = document.getElementById('player-hp');
        const playerXpEl = document.getElementById('player-xp');
        const hpFillEl = document.getElementById('hp-fill');

        let isProcessing = false;

        function updatePlayerStats(player) {
            playerNameEl.textContent = player.name;
            playerClassEl.textContent = player.class;
            playerHpEl.textContent = `${player.hp}/${player.max_hp}`;
            playerXpEl.textContent = player.xp;
            
            const hpPercentage = (player.hp / player.max_hp) * 100;
            hpFillEl.style.width = `${hpPercentage}%`;
        }

        function addMessage(type, content, actionResult = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const label = type === 'dm' ? 'üé≤ Dungeon Master' : '‚öîÔ∏è You';
            
            let html = `
                <div class="message-label">${label}</div>
                <div class="message-content">${content}</div>
            `;
            
            if (actionResult) {
                let resultText = '';
                if (actionResult.roll !== undefined) {
                    resultText = `üé≤ Roll: ${actionResult.roll}`;
                }
                if (actionResult.player_hp !== undefined) {
                    resultText += ` | HP: ${actionResult.player_hp}`;
                }
                if (resultText) {
                    html += `<div class="action-result">${resultText}</div>`;
                }
            }
            
            messageDiv.innerHTML = html;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.id = 'loading-indicator';
            loadingDiv.textContent = 'The Dungeon Master contemplates';
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideLoading() {
            const loadingDiv = document.getElementById('loading-indicator');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        async function sendAction(command) {
            if (!command.trim() || isProcessing) return;
            
            isProcessing = true;
            sendBtn.disabled = true;
            
            addMessage('player', command);
            inputField.value = '';
            showLoading();
            
            try {
                const response = await fetch(`${API_URL}/action`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to get response from DM');
                }
                
                const data = await response.json();
                hideLoading();
                
                addMessage('dm', data.dm_text, data.result);
                updatePlayerStats(data.player);
                
            } catch (error) {
                hideLoading();
                addMessage('dm', `‚ö†Ô∏è Error: ${error.message}. The mystical connection was disrupted...`);
            } finally {
                isProcessing = false;
                sendBtn.disabled = false;
                inputField.focus();
            }
        }

        sendBtn.addEventListener('click', () => {
            sendAction(inputField.value);
        });

        inputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendAction(inputField.value);
            }
        });

        inputField.focus();
    </script>
</body>
</html>